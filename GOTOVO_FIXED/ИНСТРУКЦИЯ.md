# Инструкция по установке и запуску бота

## Обзор
Данный бот предназначен для обмена криптовалюты (LTC) и работы с пользователями. В системе предусмотрены роли пользователей, операторов и администраторов.

## Системные требования
- Python 3.8 или выше
- Доступ к интернету для работы с API Telegram
- Достаточно места на диске для хранения базы данных
- Доступ к серверу Windows или Ubuntu для постоянной работы бота

## Установка

### Предварительные требования
1. Установите Python с официального сайта: https://www.python.org/downloads/
2. Для Windows: Убедитесь, что Python добавлен в PATH
3. Создайте бота в Telegram через @BotFather и получите токен

### Для Windows

1. Распакуйте архив проекта в удобную директорию

2. Откройте командную строку (cmd) в директории проекта

3. Создайте виртуальное окружение:
```
python -m venv venv
```

4. Активируйте виртуальное окружение:
```
venv\Scripts\activate
```

5. Установите необходимые зависимости:
```
pip install -r requirements.txt
```

6. Настройте конфигурацию:
   - Откройте файл `bot/config/constants.py`
   - Замените значения `BOT_TOKEN`, `ADMIN_ID` и `MAIN_CHAT_ID` на свои

7. Запустите бота:
```
python main.py
```

### Для Ubuntu

1. Распакуйте архив проекта в удобную директорию

2. Откройте терминал в директории проекта

3. Создайте виртуальное окружение:
```
python3 -m venv venv
```

4. Активируйте виртуальное окружение:
```
source venv/bin/activate
```

5. Установите необходимые зависимости:
```
pip install -r requirements.txt
```

6. Настройте конфигурацию:
   - Откройте файл `bot/config/constants.py`
   - Замените значения `BOT_TOKEN`, `ADMIN_ID` и `MAIN_CHAT_ID` на свои

7. Запустите бота:
```
python3 main.py
```

## Настройка автозапуска

### Для Windows

1. Создайте BAT-файл для запуска бота:
```
@echo off
cd /d "путь_к_папке_проекта"
call venv\Scripts\activate
python main.py
pause
```

2. Создайте ярлык для этого BAT-файла и поместите его в автозагрузку:
   - Нажмите `Win+R`, введите `shell:startup` и нажмите Enter
   - Скопируйте ярлык BAT-файла в открывшуюся папку

### Для Ubuntu

1. Создайте сервисный файл для systemd:
```
sudo nano /etc/systemd/system/crypto-bot.service
```

2. Добавьте следующее содержимое (замените пути на свои):
```
[Unit]
Description=Crypto Exchange Telegram Bot
After=network.target

[Service]
User=your_username
WorkingDirectory=/путь/к/проекту
ExecStart=/путь/к/проекту/venv/bin/python /путь/к/проекту/main.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

3. Включите и запустите сервис:
```
sudo systemctl enable crypto-bot.service
sudo systemctl start crypto-bot.service
```

4. Проверьте статус:
```
sudo systemctl status crypto-bot.service
```

## Файл requirements.txt

Если файл отсутствует, создайте его со следующим содержимым:

```
python-telegram-bot==20.6
requests==2.31.0
```

## Структура проекта

- `main.py` - основной файл запуска
- `bot/` - папка с модулями бота
  - `__init__.py` - инициализация модуля
  - `config/` - настройки бота
    - `constants.py` - константы (токены, ID)
    - `config.py` - функции работы с конфигурацией
  - `database.py` - функции для работы с базой данных
  - `handlers/` - обработчики сообщений
    - `user.py` - обработчики для обычных пользователей
    - `operator.py` - обработчики для операторов
    - `admin.py` - обработчики для администраторов
    - `common.py` - общие обработчики
    - `button_handler.py` - центральный обработчик кнопок
  - `utils/` - вспомогательные модули
    - `keyboards.py` - функции для создания клавиатур
    - `helpers.py` - вспомогательные функции
- `data/` - папка с файлами базы данных
  - `users.json` - пользователи
  - `orders.json` - заявки
  - `commands.json` - пользовательские команды

## Проблемы и их решения

1. **Бот не запускается**: Проверьте, что все зависимости установлены и токен валидный
2. **Ошибки доступа к файлам**: Проверьте права доступа к папке data и ее содержимому
3. **Кнопки не работают**: Проверьте версию python-telegram-bot (должна быть >= 20.0)
4. **Бот отключается**: При запуске на сервере используйте systemd или аналог для автоматического перезапуска

## Дополнительная информация

Для работы с ботом через административную панель добавлены специальные команды:
- `/admin` - доступ к административной панели (только для админов)
- `/operator` - доступ к панели оператора (для операторов и админов)
- `/start` - перезапуск бота и возврат в главное меню
- `/help` - показ справки